<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>HTML Quiz WebApp with Google Sign-In, Firestore, Three.js</title>

<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">

<style>
  body, html { margin: 0; padding: 0; overflow: hidden; }
  #bgCanvas { position: fixed; top: 0; left: 0; z-index: -1; }
</style>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r134/three.min.js"></script>
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
import { getAuth, GoogleAuthProvider, signInWithPopup, signOut } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-auth.js";
import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";

// Your Firebase config
const firebaseConfig = {
    apiKey: "AIzaSyAb3DUoDYJ1kvq23SiDI8PkTCvIt_ooUfM",
            authDomain: "html-quiz-webapp.firebaseapp.com",
            projectId: "html-quiz-webapp",
            storageBucket: "html-quiz-webapp.firebasestorage.app",
            messagingSenderId: "381717252465",
            appId: "1:381717252465:web:409a7de5a0487259ae0ed0",
            measurementId: "G-43P68MYVE0"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const provider = new GoogleAuthProvider();
const db = getFirestore(app);

window.addEventListener('DOMContentLoaded', () => {
  const loginPage = document.getElementById('loginPage');
  const sectionPage = document.getElementById('sectionPage');
  const profileName = document.getElementById('profileName');
  const profilePic = document.getElementById('profilePic');
  const signOutButton = document.getElementById('signOutButton');

  document.getElementById('googleSignInButton').addEventListener('click', async () => {
    try {
      const result = await signInWithPopup(auth, provider);
      const user = result.user;
      profileName.textContent = user.displayName;
      profilePic.src = user.photoURL;

      loginPage.classList.add('hidden');
      sectionPage.classList.remove('hidden');

      await setDoc(doc(db, "users", user.uid), {
        name: user.displayName,
        email: user.email,
        photoURL: user.photoURL,
        lastLogin: new Date()
      });

    } catch (error) {
      console.error(error);
      alert(`Google Sign-In failed: ${error.code} - ${error.message}`);
    }
  });

  signOutButton.addEventListener('click', async () => {
    await signOut(auth);
    sectionPage.classList.add('hidden');
    loginPage.classList.remove('hidden');
    alert("You have been signed out.");
  });

  // THREE.JS Particle Background
  const scene = new THREE.Scene();
  const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
  const renderer = new THREE.WebGLRenderer({ canvas: document.getElementById('bgCanvas'), alpha: true });
  renderer.setSize(window.innerWidth, window.innerHeight);

  const particles = new THREE.Geometry();
  const particleMaterial = new THREE.PointsMaterial({ color: 0xffffff, size: 1 });

  for (let i = 0; i < 5000; i++) {
    const particle = new THREE.Vector3(
      (Math.random() - 0.5) * 1000,
      (Math.random() - 0.5) * 1000,
      (Math.random() - 0.5) * 1000
    );
    particles.vertices.push(particle);
  }

  const particleSystem = new THREE.Points(particles, particleMaterial);
  scene.add(particleSystem);
  camera.position.z = 500;

  function animate() {
    requestAnimationFrame(animate);
    particleSystem.rotation.x += 0.0005;
    particleSystem.rotation.y += 0.001;
    renderer.render(scene, camera);
  }
  animate();

  window.addEventListener('resize', () => {
    camera.aspect = window.innerWidth / window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
  });
});
</script>
</head>

<body class="text-white min-h-screen flex flex-col items-center justify-center p-6">

<canvas id="bgCanvas"></canvas>

<!-- Login Page -->
<div id="loginPage" class="flex flex-col space-y-4 w-full max-w-xs z-10">
  <h1 class="text-2xl font-bold text-center">Login to Continue</h1>
  <button id="googleSignInButton" class="bg-red-600 hover:bg-red-700 p-2 rounded">Sign in with Google</button>
</div>

<!-- Section Page -->
<div id="sectionPage" class="hidden flex flex-col items-center space-y-4 z-10">
  <img id="profilePic" class="w-20 h-20 rounded-full border-4 border-white" alt="Profile Picture">
  <h2 id="profileName" class="text-xl font-semibold"></h2>
  <h1 class="text-2xl font-bold">Welcome to HTML Quiz</h1>
  <p>Select a quiz level to start.</p>
  <button class="bg-green-600 p-2 rounded">Basics</button>
  <button class="bg-yellow-600 p-2 rounded">Intermediate</button>
  <button class="bg-purple-600 p-2 rounded">Advanced</button>
  <button id="signOutButton" class="bg-gray-700 hover:bg-gray-800 p-2 rounded">Sign Out</button>
</div>

</body>
</html>
